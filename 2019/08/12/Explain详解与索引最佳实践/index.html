<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Explain详解与索引最佳实践 | 当代十八线浪漫主义码农诗人</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Explain工具介绍使用EXPLAIN关键字可以模拟优化器执行SQL语句，分析你的查询语句或是结构的性能瓶颈。">
<meta property="og:type" content="article">
<meta property="og:title" content="Explain详解与索引最佳实践">
<meta property="og:url" content="http://example.com/2019/08/12/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="当代十八线浪漫主义码农诗人">
<meta property="og:description" content="Explain工具介绍使用EXPLAIN关键字可以模拟优化器执行SQL语句，分析你的查询语句或是结构的性能瓶颈。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/28.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/29.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/30.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/31.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/32.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/33.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/34.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/35.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/36.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/37.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/38.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/39.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/40.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/41.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/42.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/43.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/44.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/45.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/46.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/47.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/48.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/49.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/50.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/51.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/52.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/53.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/54.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/55.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/56.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/57.png">
<meta property="og:image" content="http://r2cex8oik.hn-bkt.clouddn.com/58.png">
<meta property="article:published_time" content="2019-08-12T01:37:08.000Z">
<meta property="article:modified_time" content="2021-11-12T03:59:52.727Z">
<meta property="article:author" content="公众号：书香颜 | 微信号: phideonvw">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r2cex8oik.hn-bkt.clouddn.com/28.png">
  
    <link rel="alternate" href="/atom.xml" title="当代十八线浪漫主义码农诗人" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">当代十八线浪漫主义码农诗人</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/">About Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Explain详解与索引最佳实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/12/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time datetime="2019-08-12T01:37:08.000Z" itemprop="datePublished">2019-08-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Explain详解与索引最佳实践
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Explain工具介绍"><a href="#Explain工具介绍" class="headerlink" title="Explain工具介绍"></a>Explain工具介绍</h2><p>使用EXPLAIN关键字可以模拟优化器执行SQL语句，分析你的查询语句或是结构的性能瓶颈。</p>
<span id="more"></span>

<p>在 select 语句之前增加 explain 关键字，MySQL 会在查询上设置一个标记，执行查询会返回执行计划的信息，而不是执行这条SQL。<br>注意：如果 from 中包含子查询，仍会执行该子查询，将结果放入临时表中。</p>
<h3 id="Explain分析示例"><a href="#Explain分析示例" class="headerlink" title="Explain分析示例"></a>Explain分析示例</h3><p>参考官方文档：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></p>
<p>我们可以去MySQL官网下载实例数据库，这里选择sakila数据库，下载链接：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/index-other.html">MySQL :: Other MySQL Documentation</a>，导入到MySQL里即可。</p>
<p>执行最简单的explain命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from actor;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/28.png"></p>
<p>如果是多个表，就对应多行。</p>
<h3 id="Explain中每一列的含义："><a href="#Explain中每一列的含义：" class="headerlink" title="Explain中每一列的含义："></a>Explain中每一列的含义：</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p>id列的编号是 select 的序列号，有几个 select 就有几个id，并且id的顺序是按 select 出现的顺序增长的。<br>id列越大执行优先级越高，id相同则从上往下执行，id为NULL最后执行。</p>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p>select_type 表示对应行是简单还是复杂的查询。<br>1）simple：简单查询。查询不包含子查询和union；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from film where film_id = 2;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/29.png"></p>
<p>2）primary：复杂查询中最外层的 select；<br>3）subquery：包含在 select 中的子查询（不在 from 子句中）；<br>4）derived：包含在 from 子句中的子查询。MySQL会将结果存放在一个临时表中，也称为派生表；<br>用这个例子来了解 primary、subquery 和 derived 类型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set session optimizer_switch=&#x27;derived_merge=off&#x27;; #关闭mysql5.7新特性对衍生表的合并优化</span><br><span class="line">explain select (select 1 from actor where actor_id = 1) from (select * from film where film_id = 1) der;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/30.png"></p>
<p>5）union：在 union 中的第二个和随后的 select;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select min(id) from film;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/31.png"></p>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>这一列表示 explain 的一行正在访问哪个表。<br>当 from 子句中有子查询时，table列是 &lt;derivenN&gt; 格式，表示当前查询依赖 id=N 的查询，于是先执行 id=N 的查询。<br>当有 union 时，UNION RESULT 的 table 列的值为&lt;union1,2&gt;，1和2表示参与 union 的 select 行id。</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>这一列表示关联类型或访问类型，即MySQL决定如何查找表中的行，查找数据行记录的大概范围。<br>依次从最优到最差分别为：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL。<br>一般来说，得保证查询达到range级别，最好达到ref。<br>NULL：mysql能够在优化阶段分解查询语句，在执行阶段用不着再访问表或索引。例如：在索引列中选取最小值，可以单独查找索引来完成，不需要在执行时访问表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select min(film_id) from film;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/32.png"></p>
<p>const, system：mysql能对查询的某部分进行优化并将其转化成一个常量（可以看show warnings 的果）。用于primary key 或 unique key 的所有列与常数比较时，所以表最多有一个匹配行，读取1次，速度比较快。system是const的特例，表里只有一条元组匹配时为system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain extended select * from (select * from film where film_id = 1) tmp;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/33.png"></p>
<p>eq_ref：primary key 或 unique key 索引的所有部分被连接使用 ，最多只会返回一条符合条件的记录。这可能是在const 之外最好的联接类型了，简单的 select 查询不会出现这种 type。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from film_actor left join film on film_actor.film_id = film.film_id;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/34.png"></p>
<p>ref：相比 eq_ref，不使用唯一索引，而是使用普通索引或者唯一性索引的部分前缀，索引要和某个值相比较，可能会找到多个符合条件的行。</p>
<ol>
<li><p>简单 select 查询，name是普通索引（非唯一索引）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from film where title = &#x27;film1&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/35.png"></p>
</li>
<li><p>关联表查询，idx_film_actor_id是film_id和actor_id的联合索引，这里使用到了film_actor的左边前缀film_id部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select film.film_id from film left join film_actor on film.film_id = film_actor.film_id;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/36.png"></p>
</li>
</ol>
<p>range：范围扫描通常出现在 in(), between ,&gt; ,&lt;, &gt;= 等操作中。使用一个索引来检索给定范围的行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from actor where actor.actor_id &gt; 1;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/37.png"></p>
<p>index：扫描全索引就能拿到结果，一般是扫描某个二级索引，这种扫描不会从索引树根节点开始快速查找，而是直接对二级索引的叶子节点遍历和扫描，速度还是比较慢的，这种查询一般为使用覆盖索引，二级索引一般比较小，所以这种通常比ALL快一些。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select film_id from film_category;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/38.png"></p>
<p>ALL：即全表扫描，扫描你的聚簇索引的所有叶子节点。通常情况下这需要增加索引来进行优化了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from actor;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/39.png"></p>
<h4 id="possible-keys列"><a href="#possible-keys列" class="headerlink" title="possible_keys列"></a>possible_keys列</h4><p>这一列显示查询可能使用哪些索引来查找。<br>explain 时可能出现 possible_keys 有列，而 key 显示 NULL 的情况，这种情况是因为表中数据不多，mysql认为索引对此查询帮助不大，选择了全表查询。<br>如果该列是NULL，则没有相关的索引。在这种情况下，可以通过检查 where 子句看是否可以创造一个适当的索引来提高查询性能，然后用 explain 查看效果。</p>
<h4 id="key列"><a href="#key列" class="headerlink" title="key列"></a>key列</h4><p>这一列显示mysql实际采用哪个索引来优化对该表的访问。<br>如果没有使用索引，则该列是 NULL。如果想强制mysql使用或忽视possible_keys列中的索引，在查询中使用 forceindex、ignore index。</p>
<h4 id="key-len列"><a href="#key-len列" class="headerlink" title="key_len列"></a>key_len列</h4><p>这一列显示了mysql在索引里使用的字节数，通过这个值可以算出具体使用了索引中的哪些列。<br>举例来说，film_actor的索引 idx_fk_film_id，每个smallint是2字节。通过结果中的key_len=2可推断出查询使用了第一个列：film_id列来执行索引查找。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from film_actor where film_id = 2;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/40.png"></p>
<p>key_len计算规则如下：<br>字符串，char(n)和varchar(n)，5.0.3以后版本中，n均代表字符数，而不是字节数，如果是utf-8，一个数字<br>或字母占1个字节，一个汉字占3个字节。<br>                char(n)：如果存汉字长度就是 3n 字节<br>                varchar(n)：如果存汉字则长度是 3n + 2 字节，加的2字节用来存储字符串长度，因为<br>                varchar是变长字符串<br>数值类型<br>                tinyint：1字节<br>                smallint：2字节<br>                int：4字节<br>                bigint：8字节　　<br>时间类型　<br>                date：3字节<br>                timestamp：4字节<br>                datetime：8字节<br>如果字段允许为 NULL，需要1字节记录是否为 NULL<br>索引最大长度是768字节，当字符串过长时，mysql会做一个类似左前缀索引的处理，将前半部分的字符提取出来做索引。</p>
<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>这一列显示了在key列记录的索引中，表查找值所用到的列或常量，常见的有：const（常量），字段名（例：film.id）</p>
<h4 id="row"><a href="#row" class="headerlink" title="row"></a>row</h4><p>这一列是mysql估计要读取并检测的行数，注意这个不是结果集里的行数。</p>
<h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p>这一列展示的是额外信息。常见的重要值如下：<br>1）Using index：使用覆盖索引<br>覆盖索引定义：mysql执行计划explain结果里的key有使用索引，如果select后面查询的字段都可以从这个索引的树中获取，这种情况一般可以说是用到了覆盖索引，extra里一般都有using index；覆盖索引一般针对的是辅助索引，整个查询结果只通过辅助索引就能拿到结果，不需要通过辅助索引树找到主键，再通过主键去主键索引树里获取其它字段值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select film_id from film_actor where film_id = 1;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/41.png"></p>
<p>2）Using where：使用 where 语句来处理结果，并且查询的列未被索引覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from actor where first_name = &#x27;a&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/42.png"></p>
<p>3）Using index condition：查询的列不完全被索引覆盖，where条件中是一个前导列的范围；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from inventory where store_id &gt; 14;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/43.png"></p>
<p>4）Using temporary：mysql需要创建一张临时表来处理查询。出现这种情况一般是要进行优化的，首先是想到用索引来优化。</p>
<ol>
<li><p>actor.name没有索引，此时创建了张临时表来distinct</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select distinct first_name from actor;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/44.png"></p>
</li>
<li><p>film.title建立了idx_title索引，此时查询时extra是using index,没有用临时表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select distinct title from film;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/45.png"></p>
</li>
</ol>
<p>5）Using filesort：将用外部排序而不是索引排序，数据较小时从内存排序，否则需要在磁盘完成排序。这种情况下一般也是要考虑使用索引来优化的。</p>
<p>actor.first_name未创建索引，会浏览actor整个表，保存排序关键字first_name和对应的id，然后排序first_name并检索行记录;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from actor order by first_name;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/46.png"></p>
<p>6）Select tables optimized away：使用某些聚合函数（比如 max、min）来访问存在索引的某个字段.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select min(film_id) from film;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/47.png"></p>
<h2 id="索引最佳实践"><a href="#索引最佳实践" class="headerlink" title="索引最佳实践"></a>索引最佳实践</h2><p>定义实例表并插入数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `employees`</span><br><span class="line">(</span><br><span class="line">    `id`        int(11)     NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `name`      varchar(24) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;姓名&#x27;,</span><br><span class="line">    `age`       int(11)     NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;年龄&#x27;,</span><br><span class="line">    `position`  varchar(20) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;职位&#x27;,</span><br><span class="line">    `hire_time` timestamp   NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;入职时间&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    KEY `idx_name_age_position` (`name`, `age`, `position`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB</span><br><span class="line">  AUTO_INCREMENT = 4</span><br><span class="line">  DEFAULT CHARSET = utf8 COMMENT =&#x27;员工记录表&#x27;;</span><br><span class="line"></span><br><span class="line">INSERT INTO employees(name, age, position, hire_time) VALUES (&#x27;LiLei&#x27;, 22, &#x27;manager&#x27;, NOW());</span><br><span class="line">INSERT INTO employees(name, age, position, hire_time)VALUES (&#x27;HanMeimei&#x27;,23, &#x27;dev&#x27;, NOW());</span><br><span class="line">INSERT INTO employees(name, age, position, hire_time)VALUES (&#x27;Lucy&#x27;, 23, &#x27;dev&#x27;, NOW());</span><br></pre></td></tr></table></figure>

<h4 id="1-全值匹配"><a href="#1-全值匹配" class="headerlink" title="1.全值匹配"></a>1.全值匹配</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name= &#x27;LiLei&#x27; AND age = 22;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/48.png"></p>
<h4 id="2-最左前缀法则"><a href="#2-最左前缀法则" class="headerlink" title="2.最左前缀法则"></a>2.最左前缀法则</h4><p>如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始并且不跳过索引中的列。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name = &#x27;Bill&#x27; and age = 31;</span><br><span class="line">EXPLAIN SELECT * FROM employees WHERE age = 30 AND position = &#x27;dev&#x27;;</span><br><span class="line">EXPLAIN SELECT * FROM employees WHERE position = &#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/49.png"></p>
<h4 id="3-不在索引列上做任何操作（计算、函数、（自动or手动）类型转换），会导致索引失效而转向全表扫描"><a href="#3-不在索引列上做任何操作（计算、函数、（自动or手动）类型转换），会导致索引失效而转向全表扫描" class="headerlink" title="3.不在索引列上做任何操作（计算、函数、（自动or手动）类型转换），会导致索引失效而转向全表扫描"></a>3.不在索引列上做任何操作（计算、函数、（自动or手动）类型转换），会导致索引失效而转向全表扫描</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE left(name,3) = &#x27;LiLei&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/50.png"></p>
<h4 id="4-存储引擎不能使用索引中范围条件右边的列"><a href="#4-存储引擎不能使用索引中范围条件右边的列" class="headerlink" title="4.存储引擎不能使用索引中范围条件右边的列"></a>4.存储引擎不能使用索引中范围条件右边的列</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name= &#x27;LiLei&#x27; AND age &gt; 22 AND position =&#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/51.png"></p>
<h4 id="5-尽量使用覆盖索引（只访问索引的查询（索引列包含查询列）），减少-select-语句"><a href="#5-尽量使用覆盖索引（只访问索引的查询（索引列包含查询列）），减少-select-语句" class="headerlink" title="5.尽量使用覆盖索引（只访问索引的查询（索引列包含查询列）），减少 select * 语句"></a>5.尽量使用覆盖索引（只访问索引的查询（索引列包含查询列）），减少 select * 语句</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name= &#x27;LiLei&#x27; AND age = 23 AND position =&#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="6-mysql在使用不等于（！-或者-lt-gt-），not-in-，not-exists-的时候无法使用索引会导致全表扫描-lt-小于、-gt-大于、-lt-、-gt-这些，MySQL内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引"><a href="#6-mysql在使用不等于（！-或者-lt-gt-），not-in-，not-exists-的时候无法使用索引会导致全表扫描-lt-小于、-gt-大于、-lt-、-gt-这些，MySQL内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引" class="headerlink" title="6.mysql在使用不等于（！=或者&lt;&gt;），not in ，not exists 的时候无法使用索引会导致全表扫描&lt; 小于、 &gt; 大于、 &lt;=、&gt;= 这些，MySQL内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引"></a>6.mysql在使用不等于（！=或者&lt;&gt;），not in ，not exists 的时候无法使用索引会导致全表扫描&lt; 小于、 &gt; 大于、 &lt;=、&gt;= 这些，MySQL内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name != &#x27;LiLei&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/52.png"></p>
<h4 id="7-is-null-is-not-null-一般情况下也无法使用索引"><a href="#7-is-null-is-not-null-一般情况下也无法使用索引" class="headerlink" title="7.is null,is not null 一般情况下也无法使用索引"></a>7.is null,is not null 一般情况下也无法使用索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name is null</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/53.png"></p>
<h4 id="8-like以通配符开头（’-abc…’）mysql索引失效会变成全表扫描操作"><a href="#8-like以通配符开头（’-abc…’）mysql索引失效会变成全表扫描操作" class="headerlink" title="8.like以通配符开头（’$abc…’）mysql索引失效会变成全表扫描操作"></a>8.like以通配符开头（’$abc…’）mysql索引失效会变成全表扫描操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name like &#x27;%Lei&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/54.png"></p>
<p>问题：解决like’%字符串%’索引不被使用的方法？</p>
<p>a）使用覆盖索引，查询字段必须是建立覆盖索引字段</p>
<p>b）如果不能使用覆盖索引则可能需要借助搜索引擎</p>
<h4 id="9-字符串不加单引号索引失效"><a href="#9-字符串不加单引号索引失效" class="headerlink" title="9.字符串不加单引号索引失效"></a>9.字符串不加单引号索引失效</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name = 1000;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/55.png"></p>
<h4 id="10-少用or或in，用它查询时，MySQL不一定使用索引，mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。"><a href="#10-少用or或in，用它查询时，MySQL不一定使用索引，mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。" class="headerlink" title="10.少用or或in，用它查询时，MySQL不一定使用索引，mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。"></a>10.少用or或in，用它查询时，MySQL不一定使用索引，mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name = &#x27;LiLei&#x27; or name = &#x27;HanMeimei&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/56.png"></p>
<h4 id="11-范围查询优化"><a href="#11-范围查询优化" class="headerlink" title="11.范围查询优化"></a>11.范围查询优化</h4><p>给年龄添加单值索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `employees` ADD INDEX `idx_age` (`age`) USING BTREE ;</span><br><span class="line">explain select * from employees where age &gt;=1 and age &lt;=2000;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/57.png"></p>
<p>没走索引原因：MySQL内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。比如这个例子，可能是由于单次数据量查询过大导致优化器最终选择不走索引。<br>优化方法：可以将大的范围拆分成多个小范围</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from employees where age &gt;=1 and age &lt;=1000;</span><br><span class="line">explain select * from employees where age &gt;=1001 and age &lt;=2000;</span><br></pre></td></tr></table></figure>

<p><img src="http://r2cex8oik.hn-bkt.clouddn.com/58.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/12/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" data-id="ckvvtf1tv0000eku01sio31l7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/10/08/%E3%80%8A%E6%98%A5%E7%90%B4%E6%8A%84%E3%80%8B%E8%AF%BB%E5%90%8E%E6%84%9F/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          《春琴抄》读后感
        
      </div>
    </a>
  
  
    <a href="/2019/01/12/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Redis分布式锁的使用与实现原理</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><span class="category-list-count">11</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON/" rel="tag">JSON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%85%E8%AF%BB/" rel="tag">阅读</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/12/MyBatis%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">MyBatis源码解析</a>
          </li>
        
          <li>
            <a href="/2019/10/08/%E3%80%8A%E6%98%A5%E7%90%B4%E6%8A%84%E3%80%8B%E8%AF%BB%E5%90%8E%E6%84%9F/">《春琴抄》读后感</a>
          </li>
        
          <li>
            <a href="/2019/08/12/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">Explain详解与索引最佳实践</a>
          </li>
        
          <li>
            <a href="/2019/01/12/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">Redis分布式锁的使用与实现原理</a>
          </li>
        
          <li>
            <a href="/2018/11/11/JVM%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%AE%9E%E6%88%98/">JVM调优工具详解与实战</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 公众号：书香颜 | 微信号: phideonvw<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/" class="mobile-nav-link">About Me</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>